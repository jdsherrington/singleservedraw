<!doctype html>
<html>
  <head>
    <title>Item Distributor - Get</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
  </head>
  <body>
    <div class="container center">
      <div id="content">
        <button id="getItem">Get Your Prompt</button>
      </div>
      <span id="author">Created by JDSherrington</span>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const setId = params.get("id");

      const cookieKey = `item_${setId}`;
      `â€¦`;
      const savedItem = localStorage.getItem(cookieKey);

      if (savedItem) {
        showItem(savedItem);
      }

      document
        .getElementById("getItem")
        ?.addEventListener("click", async () => {
          if (localStorage.getItem(cookieKey)) return;

          const res = await fetch(
            "https://bwkdtnbjefmphmrtftup.supabase.co/functions/v1/get-random-item",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ set_id: setId }),
            },
          );

          const data = await res.json();

          if (data.error) {
            alert(data.error);
            return;
          }

          localStorage.setItem(cookieKey, data.item);
          showItem(data.item);
        });

      function showItem(item) {
        document.getElementById("content").innerHTML = `
			<span>Your prompt:</span>
          <input type="text" id="itemText" value="${item}" readonly />
          <button onclick="copyItem()">Copy to Clipboard</button>
        `;
      }

      function copyItem() {
        const text = document.getElementById("itemText");
        text.select();
        document.execCommand("copy");
      }
    </script>
  </body>
</html>
