<!doctype html>
<html>
  <head>
    <title>Item Distributor - Create</title>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
  </head>
  <body>
    <h1>Create Item Set</h1>
    <textarea
      id="items"
      rows="10"
      cols="50"
      placeholder="One item per line"
    ></textarea
    ><br />
    <button id="generate">Generate Link</button>
    <p id="link"></p>

    <script>
      const client = window.supabase.createClient(
        "YOUR_SUPABASE_URL",
        "YOUR_SUPABASE_ANON_KEY",
      );

      document
        .getElementById("generate")
        .addEventListener("click", async () => {
          const lines = document
            .getElementById("items")
            .value.split("\n")
            .map((l) => l.trim())
            .filter((l) => l);

          if (!lines.length) {
            alert("Please enter at least one item.");
            return;
          }

          const { data, error } = await client
            .from("item_sets")
            .insert([{ items: lines }])
            .select()
            .single();

          if (error) {
            alert(error.message);
            return;
          }

          const link = `${window.location.origin}/set.html?id=${data.id}`;
          document.getElementById("link").innerHTML =
            `<a href="${link}">${link}</a>`;
        });
    </script>
  </body>
</html>
